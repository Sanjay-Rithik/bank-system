<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NexBank</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --green:   #1a6b45;
    --green-l: #eaf4ee;
    --red:     #b91c1c;
    --red-l:   #fef2f2;
    --ink:     #111;
    --ink-2:   #444;
    --ink-3:   #888;
    --border:  #e2e2e2;
    --bg:      #f7f7f5;
    --white:   #ffffff;
  }

  body { font-family: 'Inter', sans-serif; font-size: 14px; background: var(--bg); color: var(--ink); }

  /* â”€â”€ Header â”€â”€ */
  header {
    background: var(--ink); color: white;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 32px; height: 56px;
  }
  .logo { font-family: 'Playfair Display', serif; font-size: 1.3rem; letter-spacing: .02em; }
  .header-btn {
    padding: 7px 16px; border-radius: 6px; border: 1px solid rgba(255,255,255,.25);
    background: transparent; color: white; cursor: pointer; font: inherit; font-size: 13px;
    transition: background .15s;
  }
  .header-btn:hover { background: rgba(255,255,255,.1); }
  .header-btn.green { background: var(--green); border-color: var(--green); }

  /* â”€â”€ Stats strip â”€â”€ */
  .stats {
    display: flex; background: white; border-bottom: 1px solid var(--border);
    padding: 0 32px;
  }
  .stat { padding: 14px 28px; border-right: 1px solid var(--border); }
  .stat:last-child { border-right: none; }
  .stat-label { font-size: 11px; text-transform: uppercase; letter-spacing: .06em; color: var(--ink-3); }
  .stat-val { font-family: 'Playfair Display', serif; font-size: 1.4rem; margin-top: 2px; }

  /* â”€â”€ Layout â”€â”€ */
  .layout { display: flex; min-height: calc(100vh - 104px); }

  /* â”€â”€ Sidebar â”€â”€ */
  .sidebar {
    width: 200px; background: white; border-right: 1px solid var(--border);
    padding: 20px 0; flex-shrink: 0;
  }
  .nav-item {
    padding: 10px 20px; cursor: pointer; color: var(--ink-2); font-size: 13.5px;
    border-left: 3px solid transparent; transition: all .15s;
  }
  .nav-item:hover { background: var(--bg); color: var(--ink); }
  .nav-item.active { background: var(--green-l); border-left-color: var(--green); color: var(--green); font-weight: 500; }

  /* â”€â”€ Content â”€â”€ */
  .content { flex: 1; padding: 28px 32px; }
  .page { display: none; }
  .page.active { display: block; animation: fadeIn .2s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }

  .page-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 6px; }
  .page-sub   { color: var(--ink-3); font-size: 13px; margin-bottom: 20px; }

  /* â”€â”€ DSA info box â”€â”€ */
  .dsa-box {
    background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px;
    padding: 12px 16px; font-size: 12.5px; color: #78350f;
    margin-bottom: 20px; line-height: 1.6;
  }
  .dsa-box strong { color: #92400e; }

  /* â”€â”€ Card â”€â”€ */
  .card { background: white; border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 16px; }
  .card-title { font-weight: 600; font-size: 13px; margin-bottom: 14px; color: var(--ink-2); text-transform: uppercase; letter-spacing: .05em; }

  /* â”€â”€ Account cards grid â”€â”€ */
  .acc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; }
  .acc-card {
    background: white; border: 1px solid var(--border); border-radius: 10px; padding: 18px;
    cursor: pointer; transition: all .15s;
  }
  .acc-card:hover { border-color: var(--green); box-shadow: 0 2px 12px rgba(0,0,0,.07); }
  .acc-num   { font-size: 11px; color: var(--ink-3); font-weight: 600; letter-spacing: .06em; }
  .acc-name  { font-family: 'Playfair Display', serif; font-size: 1.05rem; margin: 5px 0 4px; }
  .acc-badge { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
  .badge-SAVINGS { background: var(--green-l); color: var(--green); }
  .badge-CURRENT { background: #eff6ff; color: #1d4ed8; }
  .acc-balance { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-top: 12px; }
  .acc-email { font-size: 11px; color: var(--ink-3); margin-top: 8px; }

  /* â”€â”€ Form â”€â”€ */
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .form-group { margin-bottom: 14px; }
  label { display: block; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: .05em; color: var(--ink-2); margin-bottom: 5px; }
  input, select {
    width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 6px;
    font: inherit; font-size: 13.5px; outline: none; transition: border-color .15s;
    background: var(--bg);
  }
  input:focus, select:focus { border-color: var(--green); background: white; }

  /* â”€â”€ Buttons â”€â”€ */
  .btn {
    padding: 9px 20px; border-radius: 6px; border: none; font: inherit;
    font-size: 13px; font-weight: 500; cursor: pointer; transition: all .15s;
  }
  .btn-green  { background: var(--green); color: white; }
  .btn-green:hover { background: #155c3a; }
  .btn-red    { background: var(--red); color: white; }
  .btn-red:hover { background: #991b1b; }
  .btn-outline { background: white; border: 1px solid var(--border); color: var(--ink-2); }
  .btn-outline:hover { background: var(--bg); }
  .btn-sm { padding: 6px 14px; font-size: 12px; }

  /* â”€â”€ Table â”€â”€ */
  .table-wrap { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }
  table { width: 100%; border-collapse: collapse; }
  thead { background: var(--bg); }
  th { padding: 10px 14px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: .06em; color: var(--ink-3); border-bottom: 1px solid var(--border); }
  td { padding: 12px 14px; border-bottom: 1px solid #f2f2f0; font-size: 13px; color: var(--ink-2); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: #fafaf8; }
  .credit { color: var(--green); font-weight: 600; }
  .debit  { color: var(--red);   font-weight: 600; }

  /* â”€â”€ Toast â”€â”€ */
  #toast {
    position: fixed; bottom: 24px; right: 24px; z-index: 999;
    padding: 12px 18px; border-radius: 8px; background: var(--ink); color: white;
    font-size: 13px; box-shadow: 0 4px 20px rgba(0,0,0,.15);
    opacity: 0; transform: translateY(8px); pointer-events: none;
    transition: all .2s ease;
  }
  #toast.show { opacity: 1; transform: none; }
  #toast.ok  { background: var(--green); }
  #toast.err { background: var(--red); }

  /* â”€â”€ Modal â”€â”€ */
  .overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,.4); z-index: 100;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity .2s;
    backdrop-filter: blur(2px);
  }
  .overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: white; border-radius: 12px; padding: 28px;
    width: 100%; max-width: 440px; box-shadow: 0 8px 40px rgba(0,0,0,.15);
    transform: scale(.97); transition: transform .2s; max-height: 90vh; overflow-y: auto;
  }
  .overlay.open .modal { transform: scale(1); }
  .modal-title { font-family: 'Playfair Display', serif; font-size: 1.2rem; margin-bottom: 20px; }
  .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }

  /* â”€â”€ Empty â”€â”€ */
  .empty { text-align: center; padding: 50px; color: var(--ink-3); }
  .empty-icon  { font-size: 40px; margin-bottom: 10px; }
  .empty-title { font-size: 1rem; color: var(--ink-2); margin-bottom: 4px; }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <span class="logo">NexBank</span>
  <div style="display:flex;gap:8px;">
    <button class="header-btn" onclick="doUndo()">â†© Undo</button>
    <button class="header-btn green" onclick="openModal('create')">+ New Account</button>
  </div>
</header>

<!-- STATS -->
<div class="stats">
  <div class="stat"><div class="stat-label">Accounts</div><div class="stat-val" id="s-accounts">â€”</div></div>
  <div class="stat"><div class="stat-label">Total Balance</div><div class="stat-val" id="s-balance">â€”</div></div>
  <div class="stat"><div class="stat-label">Undo Stack Size</div><div class="stat-val" id="s-undo">â€”</div></div>
</div>

<!-- MAIN -->
<div class="layout">

  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="nav-item active" onclick="showPage('accounts', this)">ğŸ¦ Accounts</div>
    <div class="nav-item"       onclick="showPage('deposit',  this)">ğŸ’³ Deposit</div>
    <div class="nav-item"       onclick="showPage('withdraw', this)">ğŸ“¤ Withdraw</div>
    <div class="nav-item"       onclick="showPage('history',  this)">ğŸ“‹ History</div>
    <div class="nav-item"       onclick="showPage('search',   this)">ğŸ” Search</div>
  </nav>

  <!-- Pages -->
  <main class="content">

    <!-- ACCOUNTS -->
    <div class="page active" id="page-accounts">
      <div class="page-title">All Accounts</div>
      <div class="page-sub">Click any account to view details</div>
      <div class="dsa-box">
        ğŸŒ² <strong>BST:</strong> Accounts are stored in a Binary Search Tree sorted by account number.
        Visiting left â†’ node â†’ right gives them in sorted order (in-order traversal).
      </div>
      <div class="acc-grid" id="accGrid">
        <div class="empty"><div class="empty-icon">â³</div>Loading...</div>
      </div>
    </div>

    <!-- DEPOSIT -->
    <div class="page" id="page-deposit">
      <div class="page-title">Deposit</div>
      <div class="page-sub">Add money to an account</div>
      <div class="dsa-box">
        ğŸ”— <strong>Linked List:</strong> Each deposit is added to the front (head) of the account's transaction linked list in O(1).
        It is also pushed onto the <strong>Undo Stack</strong> so it can be reversed.
      </div>
      <div class="card" style="max-width:420px;">
        <div class="form-group">
          <label>Account</label>
          <select id="dep-acc"></select>
        </div>
        <div class="form-group">
          <label>Amount (â‚¹)</label>
          <input type="number" id="dep-amount" placeholder="0" min="1">
        </div>
        <div class="form-group">
          <label>Note</label>
          <input type="text" id="dep-note" placeholder="e.g. Salary">
        </div>
        <button class="btn btn-green" onclick="doDeposit()">Deposit â†’</button>
      </div>
    </div>

    <!-- WITHDRAW -->
    <div class="page" id="page-withdraw">
      <div class="page-title">Withdraw</div>
      <div class="page-sub">Take money out of an account</div>
      <div class="dsa-box">
        ğŸ”— <strong>Linked List:</strong> Each withdrawal is prepended to the transaction list in O(1).
        It is also pushed onto the <strong>Undo Stack</strong> â€” click the Undo button in the header to reverse it.
      </div>
      <div class="card" style="max-width:420px;">
        <div class="form-group">
          <label>Account</label>
          <select id="with-acc"></select>
        </div>
        <div class="form-group">
          <label>Amount (â‚¹)</label>
          <input type="number" id="with-amount" placeholder="0" min="1">
        </div>
        <div class="form-group">
          <label>Note</label>
          <input type="text" id="with-note" placeholder="e.g. ATM withdrawal">
        </div>
        <button class="btn btn-red" onclick="doWithdraw()">Withdraw â†’</button>
      </div>
    </div>

    <!-- HISTORY -->
    <div class="page" id="page-history">
      <div class="page-title">Transaction History</div>
      <div class="page-sub">Transactions stored as a linked list â€” most recent first</div>
      <div class="dsa-box">
        ğŸ”— <strong>Linked List:</strong> Each node holds one transaction and a <code>next</code> pointer to the older one.
        To read all transactions we start at the <strong>head</strong> (most recent) and follow <code>.next</code> until <code>null</code>.
      </div>
      <div class="card" style="max-width:420px; margin-bottom:20px;">
        <div class="form-group" style="margin:0;">
          <label>Select Account</label>
          <select id="hist-acc" onchange="loadHistory()"></select>
        </div>
      </div>
      <div id="hist-result"></div>
    </div>

    <!-- SEARCH -->
    <div class="page" id="page-search">
      <div class="page-title">Search Accounts</div>
      <div class="page-sub">Search by name using BST traversal</div>
      <div class="dsa-box">
        ğŸŒ² <strong>BST:</strong> We do an in-order traversal to get all accounts, then filter by name.
        Searching by account number uses the BST directly â€” go left if smaller, right if larger â€” O(log n).
      </div>
      <div class="card" style="max-width:420px; margin-bottom:20px;">
        <div class="form-group" style="margin:0;">
          <label>Search by name</label>
          <input type="text" id="search-input" placeholder="e.g. Alice" oninput="doSearch(this.value)">
        </div>
      </div>
      <div id="search-result"></div>
    </div>

  </main>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- MODAL: New Account -->
<div class="overlay" id="modal-create">
  <div class="modal">
    <div class="modal-title">Open New Account</div>
    <div class="form-row">
      <div class="form-group">
        <label>Full Name *</label>
        <input id="c-name" placeholder="Jane Doe">
      </div>
      <div class="form-group">
        <label>Account Type</label>
        <select id="c-type">
          <option value="SAVINGS">Savings</option>
          <option value="CURRENT">Current</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label>Email</label>
      <input id="c-email" type="email" placeholder="jane@example.com">
    </div>
    <div class="form-group">
      <label>Initial Deposit (â‚¹)</label>
      <input id="c-balance" type="number" placeholder="0" min="0">
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('create')">Cancel</button>
      <button class="btn btn-green"   onclick="createAccount()">Open Account</button>
    </div>
  </div>
</div>

<!-- MODAL: Account Detail -->
<div class="overlay" id="modal-detail">
  <div class="modal">
    <div id="detail-body"></div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('detail')">Close</button>
    </div>
  </div>
</div>

<script>
// All API calls go to /api (relative URL â€” same origin, no CORS)
const API = '/api';
let allAccounts = [];

// â”€â”€ Page navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(name, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  if (el) el.classList.add('active');
  if (name === 'deposit' || name === 'withdraw' || name === 'history') fillAccountSelects();
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'show ' + type;
  setTimeout(() => el.className = '', 3000);
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id)  { document.getElementById('modal-' + id).classList.add('open'); }
function closeModal(id) { document.getElementById('modal-' + id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

// â”€â”€ API helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function get(url) {
  const r = await fetch(API + url);
  if (!r.ok) throw new Error((await r.json()).error);
  return r.json();
}
async function post(url, data) {
  const r = await fetch(API + url, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) });
  const j = await r.json();
  if (!r.ok) throw new Error(j.error);
  return j;
}

// â”€â”€ Load accounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAccounts() {
  try {
    allAccounts = await get('/accounts');
    renderGrid(allAccounts);
    loadStats();
    fillAccountSelects();
  } catch(e) {
    document.getElementById('accGrid').innerHTML =
      `<div class="empty"><div class="empty-icon">âš ï¸</div><div class="empty-title">Cannot reach server</div><p>Make sure the Java server is running on port 8080.</p></div>`;
  }
}

function renderGrid(accounts) {
  const grid = document.getElementById('accGrid');
  if (!accounts.length) {
    grid.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ¦</div><div class="empty-title">No accounts yet</div></div>';
    return;
  }
  grid.innerHTML = accounts.map(a => `
    <div class="acc-card" onclick="showDetail('${a.accountNumber}')">
      <div class="acc-num">${a.accountNumber}</div>
      <div class="acc-name">${x(a.ownerName)}</div>
      <span class="acc-badge badge-${a.type}">${a.type}</span>
      <div class="acc-balance">â‚¹${fmt(a.balance)}</div>
      <div class="acc-email">${x(a.email)}</div>
    </div>`).join('');
}

// â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadStats() {
  try {
    const s = await get('/stats');
    document.getElementById('s-accounts').textContent = s.totalAccounts;
    document.getElementById('s-balance').textContent  = 'â‚¹' + fmt(s.totalBalance);
    document.getElementById('s-undo').textContent     = s.undoStackSize;
  } catch(e) {}
}

// â”€â”€ Fill selects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fillAccountSelects() {
  ['dep-acc','with-acc','hist-acc'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const cur = el.value;
    el.innerHTML = allAccounts.map(a =>
      `<option value="${a.accountNumber}">${a.accountNumber} â€” ${x(a.ownerName)} (â‚¹${fmt(a.balance)})</option>`
    ).join('');
    if (cur) el.value = cur;
  });
}

// â”€â”€ Show account detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function showDetail(accNum) {
  const acc = await get('/accounts/' + accNum);
  document.getElementById('detail-body').innerHTML = `
    <div style="background:var(--green);border-radius:8px;padding:20px;color:white;margin-bottom:16px;">
      <div style="font-size:11px;opacity:.7;letter-spacing:.06em;text-transform:uppercase;">${acc.accountNumber} Â· ${acc.type}</div>
      <div style="font-family:'Playfair Display',serif;font-size:1.4rem;margin:6px 0 4px;">${x(acc.ownerName)}</div>
      <div style="font-size:11px;opacity:.7;">Balance</div>
      <div style="font-family:'Playfair Display',serif;font-size:2rem;">â‚¹${fmt(acc.balance)}</div>
    </div>
    <div style="font-size:13px;color:var(--ink-2);">
      <div style="margin-bottom:6px;"><b>Email:</b> ${x(acc.email)}</div>
    </div>`;
  openModal('detail');
}

// â”€â”€ Create Account â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function createAccount() {
  const name    = document.getElementById('c-name').value.trim();
  const email   = document.getElementById('c-email').value.trim();
  const type    = document.getElementById('c-type').value;
  const balance = parseFloat(document.getElementById('c-balance').value) || 0;
  if (!name) { toast('Enter a name.', 'err'); return; }
  try {
    await post('/accounts', { ownerName: name, email, balance, type });
    toast('Account created!', 'ok');
    closeModal('create');
    ['c-name','c-email','c-balance'].forEach(id => document.getElementById(id).value = '');
    loadAccounts();
  } catch(e) { toast(e.message, 'err'); }
}

// â”€â”€ Deposit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doDeposit() {
  const acc    = document.getElementById('dep-acc').value;
  const amount = parseFloat(document.getElementById('dep-amount').value);
  const note   = document.getElementById('dep-note').value || 'Deposit';
  if (!acc || !amount) { toast('Fill in all fields.', 'err'); return; }
  try {
    await post('/accounts/' + acc + '/deposit', { amount, note });
    toast('Deposited â‚¹' + fmt(amount) + ' successfully!', 'ok');
    document.getElementById('dep-amount').value = '';
    loadAccounts();
  } catch(e) { toast(e.message, 'err'); }
}

// â”€â”€ Withdraw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doWithdraw() {
  const acc    = document.getElementById('with-acc').value;
  const amount = parseFloat(document.getElementById('with-amount').value);
  const note   = document.getElementById('with-note').value || 'Withdrawal';
  if (!acc || !amount) { toast('Fill in all fields.', 'err'); return; }
  try {
    await post('/accounts/' + acc + '/withdraw', { amount, note });
    toast('Withdrawn â‚¹' + fmt(amount) + ' successfully!', 'ok');
    document.getElementById('with-amount').value = '';
    loadAccounts();
  } catch(e) { toast(e.message, 'err'); }
}

// â”€â”€ Undo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doUndo() {
  try {
    const r = await post('/undo', {});
    toast(r.message, 'ok');
    loadAccounts();
  } catch(e) { toast(e.message, 'err'); }
}

// â”€â”€ Transaction History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHistory() {
  const acc = document.getElementById('hist-acc').value;
  if (!acc) return;
  try {
    const txs = await get('/accounts/' + acc + '/history');
    const el  = document.getElementById('hist-result');
    if (!txs.length) {
      el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“‹</div><div class="empty-title">No transactions yet</div></div>';
      return;
    }
    el.innerHTML = `
      <div class="table-wrap">
        <table>
          <thead><tr><th>TX ID</th><th>Type</th><th>Amount</th><th>Balance After</th><th>Note</th></tr></thead>
          <tbody>
            ${txs.map(t => `
              <tr>
                <td style="font-family:monospace;font-size:12px;">${t.id}</td>
                <td><span class="acc-badge ${t.type==='DEPOSIT'?'badge-SAVINGS':'badge-CURRENT'}">${t.type}</span></td>
                <td class="${t.type==='DEPOSIT'?'credit':'debit'}">â‚¹${fmt(t.amount)}</td>
                <td>â‚¹${fmt(t.balanceAfter)}</td>
                <td style="color:var(--ink-3)">${x(t.note)}</td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>`;
  } catch(e) { toast(e.message, 'err'); }
}

// â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doSearch(name) {
  if (!name.trim()) { document.getElementById('search-result').innerHTML = ''; return; }
  try {
    const results = await get('/search?name=' + encodeURIComponent(name));
    const el = document.getElementById('search-result');
    if (!results.length) {
      el.innerHTML = '<div style="color:var(--ink-3);padding:12px 0;">No accounts found.</div>';
      return;
    }
    el.innerHTML = `<div class="acc-grid">${results.map(a => `
      <div class="acc-card" onclick="showDetail('${a.accountNumber}')">
        <div class="acc-num">${a.accountNumber}</div>
        <div class="acc-name">${x(a.ownerName)}</div>
        <span class="acc-badge badge-${a.type}">${a.type}</span>
        <div class="acc-balance">â‚¹${fmt(a.balance)}</div>
      </div>`).join('')}</div>`;
  } catch(e) {}
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(n) { return Number(n).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
function x(s)   { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// Boot
loadAccounts();
</script>
</body>
</html>
